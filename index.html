<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>MAQUINA EXPENDEDORA</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; font-size: 11pt; line-height: 1.4; margin: 20px; }
  </style>
</head>
<body>
  <h1>MAQUINA EXPENDEDORA</h1>
  <img src="./circuito.png" alt="imagen del circuito" width="300" height="auto">

  <p>Para realizar la práctica he implementado una máquina de estados principal, con los estados de “ARRANQUE” , “SERVICIO” Y “ADMIN” y dos máquinas de estado secundarias, una dentro del estado servicio y otra dentro del estado admin.</p>

  <p>La máquina de estados de servicio tiene los estados : ESPERANDO_CLIENTE, TEMPERATURA_HUMEDAD, PRODUCTOS, PREPARACION, y RECOGIDA.</p>

  <p>Y la maquina de estados tiene los estados: ADMIN_MENU, ADMIN_TEMP, ADMIN_DIST, ADMIN_CONTADOR, ADMIN_PRODUCTOS, ADMIN_PRECIOS</p>

  <p>Solo he utilizado delays en el estado de arranque, el cual solo se ejecuta una vez. El resto del programa es no bloqueante y gestiono los tiempos con millis para no parar el loop ni interferir con las interrupciones ni con el watchdog. De igual manera solo utilizo bucles en el estado de arranque.</p>

  <p>He utilizado dos interrupciones, una para el boton del joystick y otra para el boton normal. En ellas hago lo mínimo posible, activando un flag y ejecutando lo demás en el loop principal, para hacer las interrupciones breves. He tenido muchos problemas con el rebote del boton del joystick, pero he conseguido solucionarlo midiendo con millis el tiempo transcurrido entre una interrupcion y otra y esperando a que fuese el suficiente.</p>

  <p>Tambien he tenido probemas con el sensor de temperatura pero creo que lo que no funciona es el sensor en si, porque me muestra humedades mayores del 100 % o directamente me sa nan en la temperatura y la humedad.</p>

  <p>He implementado dos funciones para usar el joystick, una para navegar por el menú del admin y los productos (tanto en admin como en servicio), modificando el indice de estos, y otro para modificar los precios. El pin correspondiente a la ”x” del joystick me controla el eje vertical y el pin “y” el eje horizontal, al menos de la forma que lo tengo puesto.</p>

  <p>Tengo otra funcion que actualiza el lcd solo cuando el mensaje que quiero mostrar es diferente al anterior, y utilizo un string de 16 espacios en vez de clear para limpiar el lcd, evitando parpadeos.</p>

  <iframe width="1324" height="745" src="https://www.youtube.com/embed/rf-5_R5AuVE" title="27 de noviembre de 2025" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
  
</body>
</html>
